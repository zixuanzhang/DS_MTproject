\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Group5 Code},
            pdfauthor={Bingyu Sun},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Group5 Code}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{Bingyu Sun}
    \preauthor{\centering\large\emph}
  \postauthor{\par}
      \predate{\centering\large\emph}
  \postdate{\par}
    \date{4/4/2019}


\begin{document}
\maketitle

\subsection{Tidy data}\label{tidy-data}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{apple_with_vpp =}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(}\StringTok{"./data/AppleStore.csv"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{janitor}\OperatorTok{::}\KeywordTok{clean_names}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\KeywordTok{c}\NormalTok{(x1, id, track_name, currency, ver)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{size_bytes =} \KeywordTok{round}\NormalTok{(size_bytes }\OperatorTok{*}\StringTok{ }\FloatTok{1e-6}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{size_megabytes =}\NormalTok{ size_bytes) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(rating_count_tot }\OperatorTok{!=}\StringTok{ }\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\CommentTok{#Remove apps with no user rating}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{prime_genre =} \KeywordTok{as.integer}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(prime_genre }\OperatorTok{==}\StringTok{ "Games"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{rating_count_tot, }\OperatorTok{-}\NormalTok{rating_count_ver) }\CommentTok{#with vpp_lic}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   X1 = col_double(),
##   id = col_double(),
##   track_name = col_character(),
##   size_bytes = col_double(),
##   currency = col_character(),
##   price = col_double(),
##   rating_count_tot = col_double(),
##   rating_count_ver = col_double(),
##   user_rating = col_double(),
##   user_rating_ver = col_double(),
##   ver = col_character(),
##   cont_rating = col_character(),
##   prime_genre = col_character(),
##   sup_devices.num = col_double(),
##   ipadSc_urls.num = col_double(),
##   lang.num = col_double(),
##   vpp_lic = col_double()
## )
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{apple =}\StringTok{ }\KeywordTok{read_csv}\NormalTok{(}\StringTok{"./data/AppleStore.csv"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{janitor}\OperatorTok{::}\KeywordTok{clean_names}\NormalTok{() }\OperatorTok{%>%}
\StringTok{  }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\KeywordTok{c}\NormalTok{(x1, id, track_name, currency, ver)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{size_bytes =} \KeywordTok{round}\NormalTok{(size_bytes }\OperatorTok{*}\StringTok{ }\FloatTok{1e-6}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{size_megabytes =}\NormalTok{ size_bytes) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(rating_count_tot }\OperatorTok{!=}\StringTok{ }\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\CommentTok{#Remove apps with no user rating}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{prime_genre =} \KeywordTok{as.integer}\NormalTok{(}\KeywordTok{ifelse}\NormalTok{(prime_genre }\OperatorTok{==}\StringTok{ "Games"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{rating_count_tot, }\OperatorTok{-}\NormalTok{rating_count_ver, }\OperatorTok{-}\NormalTok{vpp_lic) }\CommentTok{#vpp_lic has nearzero variance}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Parsed with column specification:
## cols(
##   X1 = col_double(),
##   id = col_double(),
##   track_name = col_character(),
##   size_bytes = col_double(),
##   currency = col_character(),
##   price = col_double(),
##   rating_count_tot = col_double(),
##   rating_count_ver = col_double(),
##   user_rating = col_double(),
##   user_rating_ver = col_double(),
##   ver = col_character(),
##   cont_rating = col_character(),
##   prime_genre = col_character(),
##   sup_devices.num = col_double(),
##   ipadSc_urls.num = col_double(),
##   lang.num = col_double(),
##   vpp_lic = col_double()
## )
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{skimr}\OperatorTok{::}\KeywordTok{skim}\NormalTok{(apple)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Skim summary statistics
##  n obs: 6268 
##  n variables: 9 
## 
## -- Variable type:character ----------------------------------------------------------------------------
##     variable missing complete    n min max empty n_unique
##  cont_rating       0     6268 6268   2   3     0        4
## 
## -- Variable type:integer ------------------------------------------------------------------------------
##     variable missing complete    n mean  sd p0 p25 p50 p75 p100     hist
##  prime_genre       0     6268 6268 0.54 0.5  0   0   1   1    1 ▇▁▁▁▁▁▁▇
## 
## -- Variable type:numeric ------------------------------------------------------------------------------
##          variable missing complete    n   mean     sd p0  p25   p50    p75
##  ipad_sc_urls_num       0     6268 6268   3.87   1.88  0  4     5     5   
##          lang_num       0     6268 6268   5.89   8.2   0  1     1     9   
##             price       0     6268 6268   1.82   6.13  0  0     0     2.99
##    size_megabytes       0     6268 6268 205.74 352.63  1 52   102   188.25
##   sup_devices_num       0     6268 6268  37.26   3.91  9 37    37    38   
##       user_rating       0     6268 6268   4.05   0.73  1  4     4.5   4.5 
##   user_rating_ver       0     6268 6268   3.74   1.4   0  3.5   4.5   4.5 
##     p100     hist
##     5    ▂▁▁▁▁▁▁▇
##    75    ▇▂▁▁▁▁▁▁
##   299.99 ▇▁▁▁▁▁▁▁
##  4026    ▇▁▁▁▁▁▁▁
##    47    ▁▁▁▁▁▇▇▁
##     5    ▁▁▁▁▂▅▇▂
##     5    ▁▁▁▁▁▂▃▇
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#matrix of predictors}
\NormalTok{x =}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(user_rating}\OperatorTok{~}\NormalTok{., apple)[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}
\NormalTok{y =}\StringTok{ }\NormalTok{apple}\OperatorTok{$}\NormalTok{user_rating}
\end{Highlighting}
\end{Shaded}

\subsection{EDA}\label{eda}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#boxplots for categorical variables}
\NormalTok{apple }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{cont_rating =}\NormalTok{ forcats}\OperatorTok{::}\KeywordTok{fct_reorder}\NormalTok{(cont_rating, user_rating)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ cont_rating, }\DataTypeTok{y =}\NormalTok{ user_rating)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_boxplot}\NormalTok{()}

\NormalTok{apple }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{prime_genre =} \KeywordTok{as.factor}\NormalTok{(prime_genre)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{prime_genre =}\NormalTok{ forcats}\OperatorTok{::}\KeywordTok{fct_reorder}\NormalTok{(prime_genre, user_rating)) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ prime_genre, }\DataTypeTok{y =}\NormalTok{ user_rating)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_boxplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{1}\NormalTok{))}

\CommentTok{#histograms for response}
\NormalTok{apple }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ user_rating)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_histogram}\NormalTok{()}

\CommentTok{#Correlation (no cont_rating, prime_genre)}
\NormalTok{cor_matrix =}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(user_rating }\OperatorTok{~}\NormalTok{., }\DataTypeTok{data =}\NormalTok{ apple)[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}
\NormalTok{corrplot}\OperatorTok{::}\KeywordTok{corrplot}\NormalTok{(}\KeywordTok{cor}\NormalTok{(cor_matrix))}


\NormalTok{apple }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ size_megabytes, }\DataTypeTok{y =}\NormalTok{ user_rating)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{alpha =}\NormalTok{ .}\DecValTok{5}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{stat_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{)}

\NormalTok{apple }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ price, }\DataTypeTok{y =}\NormalTok{ user_rating)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{alpha =}\NormalTok{ .}\DecValTok{5}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{stat_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{)}

\NormalTok{apple_with_vpp }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{cont_rating, }\OperatorTok{-}\NormalTok{prime_genre) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(user_rating, user_rating_ver, ipad_sc_urls_num, vpp_lic) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{gather}\NormalTok{(}\DataTypeTok{key =}\NormalTok{ variables, }\DataTypeTok{value =}\NormalTok{ x, user_rating_ver}\OperatorTok{:}\NormalTok{vpp_lic) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ user_rating)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{alpha =}\NormalTok{ .}\DecValTok{5}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{stat_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_grid}\NormalTok{(}\OperatorTok{~}\NormalTok{variables)}

\NormalTok{apple }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{select}\NormalTok{(}\OperatorTok{-}\NormalTok{cont_rating, }\OperatorTok{-}\NormalTok{prime_genre) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(user_rating, sup_devices_num, lang_num) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{gather}\NormalTok{(}\DataTypeTok{key =}\NormalTok{ variables, }\DataTypeTok{value =}\NormalTok{ x, sup_devices_num}\OperatorTok{:}\NormalTok{lang_num) }\OperatorTok{%>%}\StringTok{ }
\StringTok{  }\KeywordTok{ggplot}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ user_rating)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{alpha =}\NormalTok{ .}\DecValTok{5}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{stat_smooth}\NormalTok{(}\DataTypeTok{method =} \StringTok{"lm"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_grid}\NormalTok{(}\OperatorTok{~}\NormalTok{variables)}
\end{Highlighting}
\end{Shaded}

\paragraph{Feature plot}\label{feature-plot}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{theme1 <-}\StringTok{ }\KeywordTok{trellis.par.get}\NormalTok{()}
\NormalTok{theme1}\OperatorTok{$}\NormalTok{plot.symbol}\OperatorTok{$}\NormalTok{col <-}\StringTok{ }\KeywordTok{rgb}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{4}\NormalTok{, .}\DecValTok{2}\NormalTok{, .}\DecValTok{5}\NormalTok{)}
\NormalTok{theme1}\OperatorTok{$}\NormalTok{plot.symbol}\OperatorTok{$}\NormalTok{pch <-}\StringTok{ }\DecValTok{16}
\NormalTok{theme1}\OperatorTok{$}\NormalTok{plot.line}\OperatorTok{$}\NormalTok{col <-}\StringTok{ }\KeywordTok{rgb}\NormalTok{(.}\DecValTok{8}\NormalTok{, .}\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\NormalTok{theme1}\OperatorTok{$}\NormalTok{plot.line}\OperatorTok{$}\NormalTok{lwd <-}\StringTok{ }\DecValTok{2}
\NormalTok{theme1}\OperatorTok{$}\NormalTok{strip.background}\OperatorTok{$}\NormalTok{col <-}\StringTok{ }\KeywordTok{rgb}\NormalTok{(.}\DecValTok{0}\NormalTok{, .}\DecValTok{2}\NormalTok{, .}\DecValTok{6}\NormalTok{, .}\DecValTok{2}\NormalTok{)}
\KeywordTok{trellis.par.set}\NormalTok{(theme1)}
\KeywordTok{featurePlot}\NormalTok{(apple_with_vpp[, }\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{)], apple}\OperatorTok{$}\NormalTok{user_rating, }\DataTypeTok{plot =} \StringTok{"scatter"}\NormalTok{, }\DataTypeTok{labels =} \KeywordTok{c}\NormalTok{(}\StringTok{""}\NormalTok{,}\StringTok{"Y"}\NormalTok{),}
            \DataTypeTok{type =} \KeywordTok{c}\NormalTok{(}\StringTok{"p"}\NormalTok{), }\DataTypeTok{layout =} \KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{)) }\CommentTok{# plot numerical values}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-3-1}

\paragraph{Correlation (no content rating and primary
genre)}\label{correlation-no-content-rating-and-primary-genre}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor_matrix =}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(user_rating }\OperatorTok{~}\NormalTok{., }\DataTypeTok{data =}\NormalTok{ apple)[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}
\NormalTok{corrplot}\OperatorTok{::}\KeywordTok{corrplot}\NormalTok{(}\KeywordTok{cor}\NormalTok{(cor_matrix))}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-4-1}

\paragraph{Check linear dependency of numerical predictors (no
problematic
predictors)}\label{check-linear-dependency-of-numerical-predictors-no-problematic-predictors}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nzv <-}\StringTok{ }\KeywordTok{nearZeroVar}\NormalTok{(apple_with_vpp) }\CommentTok{# nzv: near zero variance}
\NormalTok{apple_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{apple_with_vpp[, }\OperatorTok{-}\NormalTok{nzv]}
\NormalTok{combInfo <-}\StringTok{ }\KeywordTok{findLinearCombos}\NormalTok{(apple_}\DecValTok{2}\NormalTok{[,}\OperatorTok{-}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{)]) }\CommentTok{# on numerical values}
\NormalTok{combInfo }\CommentTok{# no linear dependency problem}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $linearCombos
## list()
## 
## $remove
## NULL
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{names}\NormalTok{(apple_}\DecValTok{2}\NormalTok{) }\CommentTok{# remove vpp_lic; 8 predictors + 1 response}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "size_megabytes"   "price"            "user_rating"     
## [4] "user_rating_ver"  "cont_rating"      "prime_genre"     
## [7] "sup_devices_num"  "ipad_sc_urls_num" "lang_num"
\end{verbatim}

\paragraph{Box-cox}\label{box-cox}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(MASS)}
\NormalTok{mult.fit1 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\NormalTok{size_megabytes }\OperatorTok{+}\StringTok{ }\NormalTok{price }\OperatorTok{+}\StringTok{ }\NormalTok{user_rating_ver }\OperatorTok{+}\StringTok{ }\NormalTok{cont_rating }\OperatorTok{+}\StringTok{ }\NormalTok{prime_genre }\OperatorTok{+}\StringTok{ }\NormalTok{sup_devices_num }\OperatorTok{+}\StringTok{ }\NormalTok{ipad_sc_urls_num }\OperatorTok{+}\StringTok{ }\NormalTok{lang_num, }\DataTypeTok{data =}\NormalTok{ apple) }
\KeywordTok{boxcox}\NormalTok{(mult.fit1) }
\end{Highlighting}
\end{Shaded}

\subsection{Split to train/test sets}\label{split-to-traintest-sets}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\CommentTok{#Split data to traning and testing}
\NormalTok{trRows =}\StringTok{ }\KeywordTok{createDataPartition}\NormalTok{(apple}\OperatorTok{$}\NormalTok{user_rating,}
                             \DataTypeTok{p =}\NormalTok{ .}\DecValTok{75}\NormalTok{,}
                             \DataTypeTok{list =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{train_data =}\StringTok{ }\NormalTok{apple[trRows,]}
\NormalTok{test_data =}\StringTok{ }\NormalTok{apple[}\OperatorTok{-}\NormalTok{trRows,]}
\CommentTok{#in matrix form}
\NormalTok{x_train =}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(user_rating}\OperatorTok{~}\NormalTok{., train_data)[,}\OperatorTok{-}\DecValTok{1}\NormalTok{] }
\NormalTok{y_train =}\StringTok{ }\NormalTok{train_data}\OperatorTok{$}\NormalTok{user_rating}
\NormalTok{x_test =}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(user_rating}\OperatorTok{~}\NormalTok{., test_data)[,}\OperatorTok{-}\DecValTok{1}\NormalTok{] }
\NormalTok{y_test =}\StringTok{ }\NormalTok{test_data}\OperatorTok{$}\NormalTok{user_rating}

\NormalTok{ctrl1 =}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"repeatedcv"}\NormalTok{, }\DataTypeTok{number =} \DecValTok{10}\NormalTok{, }\DataTypeTok{repeats =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{Fit linear regression \& 10-fold repeatedCV (5
times)}\label{fit-linear-regression-10-fold-repeatedcv-5-times}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{lm.fit =}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating}\OperatorTok{~}\NormalTok{.,}
               \DataTypeTok{data =}\NormalTok{ train_data,}
               \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
               \DataTypeTok{trControl =}\NormalTok{ ctrl1)}
\NormalTok{lm.fit }\CommentTok{#RMSE 0.6289451}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Linear Regression 
## 
## 4702 samples
##    8 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold, repeated 5 times) 
## Summary of sample sizes: 4233, 4231, 4231, 4231, 4232, 4232, ... 
## Resampling results:
## 
##   RMSE       Rsquared   MAE      
##   0.6289451  0.2547178  0.4581656
## 
## Tuning parameter 'intercept' was held constant at a value of TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(lm.fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.7370 -0.2640  0.1372  0.3236  2.0354 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       2.963e+00  9.958e-02  29.759  < 2e-16 ***
## size_megabytes   -5.369e-05  2.998e-05  -1.791  0.07338 .  
## price             4.426e-03  1.845e-03   2.399  0.01650 *  
## user_rating_ver   2.367e-01  6.893e-03  34.335  < 2e-16 ***
## `cont_rating17+`  3.643e-02  4.157e-02   0.876  0.38081    
## `cont_rating4+`  -5.827e-02  2.610e-02  -2.232  0.02564 *  
## `cont_rating9+`  -7.236e-03  3.407e-02  -0.212  0.83183    
## prime_genre       1.352e-01  2.217e-02   6.099 1.16e-09 ***
## sup_devices_num   1.577e-03  2.455e-03   0.643  0.52056    
## ipad_sc_urls_num  2.144e-02  5.310e-03   4.037 5.50e-05 ***
## lang_num          4.043e-03  1.115e-03   3.627  0.00029 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.6282 on 4691 degrees of freedom
## Multiple R-squared:  0.2566, Adjusted R-squared:  0.2551 
## F-statistic:   162 on 10 and 4691 DF,  p-value: < 2.2e-16
\end{verbatim}

\subsection{Ridge, Lasso, and elastic
net}\label{ridge-lasso-and-elastic-net}

\paragraph{Ridge}\label{ridge}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# fit the ridge regression (alpha = 0) with a sequence of lambdas}
\NormalTok{ridge.mod =}\StringTok{ }\KeywordTok{glmnet}\NormalTok{(x_train, y_train, }\DataTypeTok{alpha =} \DecValTok{0}\NormalTok{, }\DataTypeTok{lambda =} \KeywordTok{exp}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\OperatorTok{-}\DecValTok{8}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length =} \DecValTok{100}\NormalTok{)))}
\KeywordTok{dim}\NormalTok{(}\KeywordTok{coef}\NormalTok{(ridge.mod))}

\CommentTok{#CV: get optimal lambda}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{cv.ridge =}\StringTok{ }\KeywordTok{cv.glmnet}\NormalTok{(x_train, y_train, }
                      \DataTypeTok{alpha =} \DecValTok{0}\NormalTok{, }
                      \DataTypeTok{lambda =} \KeywordTok{exp}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\OperatorTok{-}\DecValTok{8}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length =} \DecValTok{100}\NormalTok{)), }
                      \DataTypeTok{type.measure =} \StringTok{"mse"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(cv.ridge)}

\NormalTok{cv.ridge}\OperatorTok{$}\NormalTok{lambda.min}
\end{Highlighting}
\end{Shaded}

\paragraph{Lasso (variable selection)}\label{lasso-variable-selection}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cv.lasso =}\StringTok{ }\KeywordTok{cv.glmnet}\NormalTok{(x_train, y_train, }
                     \DataTypeTok{alpha =} \DecValTok{1}\NormalTok{, }
                     \DataTypeTok{lambda =} \KeywordTok{exp}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\OperatorTok{-}\DecValTok{6}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length =} \DecValTok{100}\NormalTok{)))}
\KeywordTok{plot}\NormalTok{(cv.lasso)}
\NormalTok{cv.lasso}\OperatorTok{$}\NormalTok{lambda.min }\CommentTok{#optimal lambda}

\KeywordTok{predict}\NormalTok{(cv.lasso, }\DataTypeTok{s =} \StringTok{"lambda.min"}\NormalTok{, }\DataTypeTok{type =} \StringTok{"coefficients"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\paragraph{Use Caret (ridge and lasso)}\label{use-caret-ridge-and-lasso}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{ridge.fit <-}\StringTok{ }\KeywordTok{train}\NormalTok{(x_train, y_train, }\DataTypeTok{method =} \StringTok{"glmnet"}\NormalTok{, }
                   \DataTypeTok{tuneGrid =} \KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{alpha =} \DecValTok{0}\NormalTok{,}
                                          \DataTypeTok{lambda =} \KeywordTok{exp}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\OperatorTok{-}\DecValTok{8}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length =} \DecValTok{100}\NormalTok{))),}
                   \DataTypeTok{trControl =}\NormalTok{ ctrl1)}

\NormalTok{lasso.fit <-}\StringTok{ }\KeywordTok{train}\NormalTok{(x_train, y_train, }\DataTypeTok{method =} \StringTok{"glmnet"}\NormalTok{, }
                   \DataTypeTok{tuneGrid =} \KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{alpha =} \DecValTok{1}\NormalTok{,}
                                          \DataTypeTok{lambda =} \KeywordTok{exp}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\OperatorTok{-}\DecValTok{6}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length =} \DecValTok{100}\NormalTok{))),}
                   \DataTypeTok{trControl =}\NormalTok{ ctrl1)}
\KeywordTok{plot}\NormalTok{(ridge.fit, }\DataTypeTok{xTrans =} \ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{log}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-11-1}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(lasso.fit, }\DataTypeTok{xTrans =} \ControlFlowTok{function}\NormalTok{(x) }\KeywordTok{log}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-11-2}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ridge.fit}\OperatorTok{$}\NormalTok{bestTune }\CommentTok{#0.03}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    alpha     lambda
## 46     0 0.03160167
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lasso.fit}\OperatorTok{$}\NormalTok{bestTune }\CommentTok{#0.005}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   alpha      lambda
## 9     1 0.004731394
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{coef}\NormalTok{(lasso.fit}\OperatorTok{$}\NormalTok{finalModel, lasso.fit}\OperatorTok{$}\NormalTok{bestTune}\OperatorTok{$}\NormalTok{lambda) }\CommentTok{#get covariates}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 11 x 1 sparse Matrix of class "dgCMatrix"
##                              1
## (Intercept)       3.013686e+00
## size_megabytes   -2.717265e-05
## price             3.049752e-03
## user_rating_ver   2.341925e-01
## cont_rating17+    1.736256e-02
## cont_rating4+    -4.725665e-02
## cont_rating9+     .           
## prime_genre       1.231547e-01
## sup_devices_num   7.099613e-04
## ipad_sc_urls_num  1.943850e-02
## lang_num          3.390353e-03
\end{verbatim}

\paragraph{Elastic net}\label{elastic-net}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{enet.fit <-}\StringTok{ }\KeywordTok{train}\NormalTok{(x_train, y_train,}
                     \DataTypeTok{method =} \StringTok{"glmnet"}\NormalTok{,}
                     \DataTypeTok{tuneGrid =} \KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{alpha =} \KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DataTypeTok{length =} \DecValTok{5}\NormalTok{), }
                                            \DataTypeTok{lambda =} \KeywordTok{exp}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\OperatorTok{-}\DecValTok{8}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DataTypeTok{length =} \DecValTok{50}\NormalTok{))),}
                     \DataTypeTok{trControl =}\NormalTok{ ctrl1)}
\NormalTok{enet.fit}\OperatorTok{$}\NormalTok{bestTune }\CommentTok{#0.004}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     alpha      lambda
## 213     1 0.003883492
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(enet.fit)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-12-1}

\subsection{PCR and PLS}\label{pcr-and-pls}

\paragraph{PCR}\label{pcr}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{pcr.fit <-}\StringTok{ }\KeywordTok{train}\NormalTok{(x_train, y_train,}
                  \DataTypeTok{method =} \StringTok{"pcr"}\NormalTok{,}
                  \DataTypeTok{tuneLength =} \DecValTok{10}\NormalTok{,}
                  \DataTypeTok{trControl =}\NormalTok{ ctrl1,}
                  \DataTypeTok{scale =} \OtherTok{TRUE}\NormalTok{) }

\NormalTok{pred.pcr <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(pcr.fit}\OperatorTok{$}\NormalTok{finalModel, }\DataTypeTok{newdata =}\NormalTok{ x_test,}
                       \DataTypeTok{ncomp =}\NormalTok{ pcr.fit}\OperatorTok{$}\NormalTok{bestTune[[}\DecValTok{1}\NormalTok{]], }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{) }\CommentTok{#7}
\KeywordTok{mean}\NormalTok{((pred.pcr }\OperatorTok{-}\StringTok{ }\NormalTok{y_test)}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{#0.407}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4068258
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(pcr.fit, }\DataTypeTok{highlight =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{theme_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-13-1}

\paragraph{PLS}\label{pls}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{pls.fit <-}\StringTok{ }\KeywordTok{train}\NormalTok{(x_train, y_train,}
                  \DataTypeTok{method =} \StringTok{"pls"}\NormalTok{,}
                  \DataTypeTok{tuneLength =} \DecValTok{10}\NormalTok{,}
                  \DataTypeTok{trControl =}\NormalTok{ ctrl1,}
                  \DataTypeTok{scale =} \OtherTok{TRUE}\NormalTok{) }

\NormalTok{pred.pls <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(pls.fit}\OperatorTok{$}\NormalTok{finalModel, }\DataTypeTok{newdata =}\NormalTok{ x_test,}
                       \DataTypeTok{ncomp =}\NormalTok{ pls.fit}\OperatorTok{$}\NormalTok{bestTune[[}\DecValTok{1}\NormalTok{]]) }\CommentTok{# 3}
\KeywordTok{mean}\NormalTok{((pred.pls }\OperatorTok{-}\StringTok{ }\NormalTok{y_test)}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{# 0.407}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4065176
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(pls.fit, }\DataTypeTok{highlight =} \OtherTok{TRUE}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{theme_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-14-1}

\subsection{Non-linear}\label{non-linear}

\paragraph{Polynomials}\label{polynomials}

CV to compare models up to d = 4 and make plot

add higher order on size\_megabytes

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{lmFit1 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\NormalTok{size_megabytes,}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1) }
\NormalTok{lmFit2 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(size_megabytes,}\DecValTok{2}\NormalTok{),}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1)}
\NormalTok{lmFit3 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(size_megabytes,}\DecValTok{3}\NormalTok{),}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1)}
\NormalTok{lmFit4 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(size_megabytes,}\DecValTok{4}\NormalTok{),}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1)}

\NormalTok{resamp <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{d1 =}\NormalTok{ lmFit1, }\DataTypeTok{d2 =}\NormalTok{ lmFit2, }\DataTypeTok{d3 =}\NormalTok{ lmFit3, }\DataTypeTok{d4 =}\NormalTok{ lmFit4)) }
\CommentTok{#summary(resamp) # RMSE}

\KeywordTok{bwplot}\NormalTok{(resamp, }\DataTypeTok{metric =} \StringTok{"RMSE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-15-1}
comment: d = 1

add higher order on user\_rating\_ver

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{lmFit1 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\NormalTok{user_rating_ver,}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1) }
\NormalTok{lmFit2 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(user_rating_ver,}\DecValTok{2}\NormalTok{),}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1)}
\NormalTok{lmFit3 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(user_rating_ver,}\DecValTok{3}\NormalTok{),}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1)}
\NormalTok{lmFit4 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(user_rating_ver,}\DecValTok{4}\NormalTok{),}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1)}

\NormalTok{resamp <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{d1 =}\NormalTok{ lmFit1, }\DataTypeTok{d2 =}\NormalTok{ lmFit2, }\DataTypeTok{d3 =}\NormalTok{ lmFit3, }\DataTypeTok{d4 =}\NormalTok{ lmFit4)) }
\CommentTok{#summary(resamp) # MSE}

\KeywordTok{bwplot}\NormalTok{(resamp, }\DataTypeTok{metric =} \StringTok{"RMSE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-16-1}
Comment: d = 3 on user\_rating\_ver

add higher order on lang\_num

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{lmFit1 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\NormalTok{lang_num,}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1) }
\NormalTok{lmFit2 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(lang_num,}\DecValTok{2}\NormalTok{),}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1)}
\NormalTok{lmFit3 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(lang_num,}\DecValTok{3}\NormalTok{),}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1)}
\NormalTok{lmFit4 <-}\StringTok{ }\KeywordTok{train}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(lang_num,}\DecValTok{4}\NormalTok{),}
                \DataTypeTok{data =}\NormalTok{ train_data, }
                \DataTypeTok{method =} \StringTok{"lm"}\NormalTok{,}
                \DataTypeTok{trControl =}\NormalTok{ ctrl1)}

\NormalTok{resamp <-}\StringTok{ }\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\DataTypeTok{d1 =}\NormalTok{ lmFit1, }\DataTypeTok{d2 =}\NormalTok{ lmFit2, }\DataTypeTok{d3 =}\NormalTok{ lmFit3, }\DataTypeTok{d4 =}\NormalTok{ lmFit4)) }
\CommentTok{#summary(resamp) # MSE}

\KeywordTok{bwplot}\NormalTok{(resamp, }\DataTypeTok{metric =} \StringTok{"RMSE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-17-1}
Conclusion: add polynomial component of lang\_num and size\_megabytes
does not make too much difference

Comment: it does not really improve too much; so better keep d = 1

check anova

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit1 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\NormalTok{size_megabytes, }\DataTypeTok{data =}\NormalTok{ train_data)  }\CommentTok{# y ~ X }
\NormalTok{fit2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(size_megabytes,}\DecValTok{2}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ train_data) }\CommentTok{# y ~ X + X^2}
\NormalTok{fit3 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(size_megabytes,}\DecValTok{3}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ train_data) }\CommentTok{# y ~ X + X^2 + X^3}
\NormalTok{fit4 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(size_megabytes,}\DecValTok{4}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ train_data) }\CommentTok{# y ~ X + X^2 + X^3 + X^4}
\KeywordTok{anova}\NormalTok{(fit1, fit2, fit3, fit4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: user_rating ~ size_megabytes
## Model 2: user_rating ~ poly(size_megabytes, 2)
## Model 3: user_rating ~ poly(size_megabytes, 3)
## Model 4: user_rating ~ poly(size_megabytes, 4)
##   Res.Df    RSS Df Sum of Sq      F    Pr(>F)    
## 1   4700 2480.8                                  
## 2   4699 2473.9  1    6.9131 13.251 0.0002754 ***
## 3   4698 2461.3  1   12.6662 24.278 8.623e-07 ***
## 4   4697 2450.5  1   10.8132 20.727 5.431e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit1 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\NormalTok{user_rating_ver, }\DataTypeTok{data =}\NormalTok{ train_data)  }\CommentTok{# y ~ X }
\NormalTok{fit2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(user_rating_ver,}\DecValTok{2}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ train_data) }\CommentTok{# y ~ X + X^2}
\NormalTok{fit3 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(user_rating_ver,}\DecValTok{3}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ train_data) }\CommentTok{# y ~ X + X^2 + X^3}
\NormalTok{fit4 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(user_rating_ver,}\DecValTok{4}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ train_data) }\CommentTok{# y ~ X + X^2 + X^3 + X^4}
\KeywordTok{anova}\NormalTok{(fit1, fit2, fit3, fit4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: user_rating ~ user_rating_ver
## Model 2: user_rating ~ poly(user_rating_ver, 2)
## Model 3: user_rating ~ poly(user_rating_ver, 3)
## Model 4: user_rating ~ poly(user_rating_ver, 4)
##   Res.Df    RSS Df Sum of Sq       F    Pr(>F)    
## 1   4700 1893.5                                   
## 2   4699 1489.1  1    404.39 1460.69 < 2.2e-16 ***
## 3   4698 1304.5  1    184.61  666.82 < 2.2e-16 ***
## 4   4697 1300.4  1      4.14   14.95 0.0001119 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit1 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\NormalTok{lang_num, }\DataTypeTok{data =}\NormalTok{ train_data)  }\CommentTok{# y ~ X }
\NormalTok{fit2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(lang_num,}\DecValTok{2}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ train_data) }\CommentTok{# y ~ X + X^2}
\NormalTok{fit3 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(lang_num,}\DecValTok{3}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ train_data) }\CommentTok{# y ~ X + X^2 + X^3}
\NormalTok{fit4 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(user_rating}\OperatorTok{~}\KeywordTok{poly}\NormalTok{(lang_num,}\DecValTok{4}\NormalTok{), }\DataTypeTok{data =}\NormalTok{ train_data)}
\KeywordTok{anova}\NormalTok{(fit1, fit2, fit3, fit4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: user_rating ~ lang_num
## Model 2: user_rating ~ poly(lang_num, 2)
## Model 3: user_rating ~ poly(lang_num, 3)
## Model 4: user_rating ~ poly(lang_num, 4)
##   Res.Df    RSS Df Sum of Sq       F    Pr(>F)    
## 1   4700 2473.9                                   
## 2   4699 2455.8  1   18.1218 34.8627 3.787e-09 ***
## 3   4698 2442.2  1   13.5944 26.1529 3.280e-07 ***
## 4   4697 2441.5  1    0.6964  1.3397    0.2472    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

Comment: ANOVA result suggest adding d = 3 to lang\_num and d = 4 on
size\_megabytes How to decide on this?

\paragraph{Smoothing splines}\label{smoothing-splines}

fit smoothing spline on size\_megabytes

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ train_data, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ size_megabytes, }\DataTypeTok{y =}\NormalTok{ user_rating)) }\OperatorTok{+}
\StringTok{     }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{color =} \KeywordTok{rgb}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{4}\NormalTok{, .}\DecValTok{2}\NormalTok{, .}\DecValTok{5}\NormalTok{))}
\NormalTok{p}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-19-1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit.ss <-}\StringTok{ }\KeywordTok{smooth.spline}\NormalTok{(train_data}\OperatorTok{$}\NormalTok{size_megabytes, }\CommentTok{# predictor (univariate)}
\NormalTok{                        train_data}\OperatorTok{$}\NormalTok{user_rating)  }\CommentTok{# response}
\NormalTok{fit.ss}\OperatorTok{$}\NormalTok{df }\CommentTok{# 14.5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 23.22019
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# look at the range}
\NormalTok{sizelims <-}\StringTok{ }\KeywordTok{range}\NormalTok{(apple}\OperatorTok{$}\NormalTok{size_megabytes)}

\CommentTok{# create a sequence of observations pgg45}
\NormalTok{size.grid <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =}\NormalTok{ sizelims[}\DecValTok{1}\NormalTok{],}\DataTypeTok{to =}\NormalTok{ sizelims[}\DecValTok{2}\NormalTok{], }\DecValTok{100}\NormalTok{)}

\NormalTok{pred.ss <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(fit.ss, }\DataTypeTok{x =}\NormalTok{ size.grid) }\CommentTok{# specify x; }
\CommentTok{# but we did not calculate CI in this function}
\NormalTok{pred.ss.df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{pred =}\NormalTok{ pred.ss}\OperatorTok{$}\NormalTok{y,}
                         \DataTypeTok{size =}\NormalTok{ size.grid)}

\NormalTok{p }\OperatorTok{+}
\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ size, }\DataTypeTok{y =}\NormalTok{ pred), }\DataTypeTok{data =}\NormalTok{ pred.ss.df,}
          \DataTypeTok{color =} \KeywordTok{rgb}\NormalTok{(.}\DecValTok{8}\NormalTok{, .}\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\OperatorTok{+}\StringTok{ }\KeywordTok{theme_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-19-2}

fit smoothing spline to lang\_num

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit.ss <-}\StringTok{ }\KeywordTok{smooth.spline}\NormalTok{(train_data}\OperatorTok{$}\NormalTok{lang_num, }\CommentTok{# predictor (univariate)}
\NormalTok{                        train_data}\OperatorTok{$}\NormalTok{user_rating)  }\CommentTok{# response}
\NormalTok{fit.ss}\OperatorTok{$}\NormalTok{df }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.865362
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# look at the range}
\NormalTok{langlims <-}\StringTok{ }\KeywordTok{range}\NormalTok{(train_data}\OperatorTok{$}\NormalTok{lang_num)}

\CommentTok{# create a sequence of observations pgg45}
\NormalTok{lang.grid <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =}\NormalTok{ langlims[}\DecValTok{1}\NormalTok{],}\DataTypeTok{to =}\NormalTok{ langlims[}\DecValTok{2}\NormalTok{])}
\NormalTok{lang.grid}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22
## [24] 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45
## [47] 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68
## [70] 69 70 71 72 73 74 75
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.ss <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(fit.ss, }\DataTypeTok{x =}\NormalTok{ lang.grid) }\CommentTok{# specify x; }
\CommentTok{# but we did not calculate CI in this function}
\NormalTok{pred.ss.df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{pred =}\NormalTok{ pred.ss}\OperatorTok{$}\NormalTok{y,}
                         \DataTypeTok{lang =}\NormalTok{ lang.grid)}
\NormalTok{pred.ss.df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        pred lang
## 1  3.939888    0
## 2  3.971486    1
## 3  4.002946    2
## 4  4.033415    3
## 5  4.062281    4
## 6  4.089302    5
## 7  4.114156    6
## 8  4.136734    7
## 9  4.157025    8
## 10 4.174931    9
## 11 4.190196   10
## 12 4.202575   11
## 13 4.211989   12
## 14 4.218362   13
## 15 4.221709   14
## 16 4.222136   15
## 17 4.219856   16
## 18 4.215214   17
## 19 4.208566   18
## 20 4.200341   19
## 21 4.191000   20
## 22 4.181011   21
## 23 4.170764   22
## 24 4.160606   23
## 25 4.150708   24
## 26 4.141051   25
## 27 4.131609   26
## 28 4.122356   27
## 29 4.113323   28
## 30 4.104544   29
## 31 4.095985   30
## 32 4.087553   31
## 33 4.079261   32
## 34 4.071252   33
## 35 4.063619   34
## 36 4.056443   35
## 37 4.049733   36
## 38 4.043514   37
## 39 4.037801   38
## 40 4.032598   39
## 41 4.027909   40
## 42 4.023734   41
## 43 4.020087   42
## 44 4.016956   43
## 45 4.014299   44
## 46 4.012058   45
## 47 4.010178   46
## 48 4.008635   47
## 49 4.007457   48
## 50 4.006673   49
## 51 4.006309   50
## 52 4.006392   51
## 53 4.006948   52
## 54 4.008004   53
## 55 4.009586   54
## 56 4.011711   55
## 57 4.014369   56
## 58 4.017553   57
## 59 4.021259   58
## 60 4.025476   59
## 61 4.030188   60
## 62 4.035357   61
## 63 4.040945   62
## 64 4.046912   63
## 65 4.053221   64
## 66 4.059849   65
## 67 4.066776   66
## 68 4.073981   67
## 69 4.081445   68
## 70 4.089143   69
## 71 4.097037   70
## 72 4.105093   71
## 73 4.113281   72
## 74 4.121567   73
## 75 4.129920   74
## 76 4.138309   75
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ train_data, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ lang_num, }\DataTypeTok{y =}\NormalTok{ user_rating)) }\OperatorTok{+}
\StringTok{     }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{color =} \KeywordTok{rgb}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{4}\NormalTok{, .}\DecValTok{2}\NormalTok{, .}\DecValTok{5}\NormalTok{))}\OperatorTok{+}
\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ lang, }\DataTypeTok{y =}\NormalTok{ pred), }\DataTypeTok{data =}\NormalTok{ pred.ss.df,}
          \DataTypeTok{color =} \KeywordTok{rgb}\NormalTok{(.}\DecValTok{8}\NormalTok{, .}\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\OperatorTok{+}\StringTok{ }\KeywordTok{theme_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-20-1}

fit smoothing spline to user\_rating\_ver

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit.ss <-}\StringTok{ }\KeywordTok{smooth.spline}\NormalTok{(train_data}\OperatorTok{$}\NormalTok{user_rating_ver, }\CommentTok{# predictor (univariate)}
\NormalTok{                        train_data}\OperatorTok{$}\NormalTok{user_rating)  }\CommentTok{# response}
\NormalTok{fit.ss}\OperatorTok{$}\NormalTok{df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 8.548232
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit.ss}\OperatorTok{$}\NormalTok{lambda }\CommentTok{# 0.05}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.004566497
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# look at the range}
\NormalTok{ratelims <-}\StringTok{ }\KeywordTok{range}\NormalTok{(train_data}\OperatorTok{$}\NormalTok{user_rating_ver)}

\CommentTok{# create a sequence of observations }
\NormalTok{rate.grid <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DataTypeTok{from =}\NormalTok{ ratelims[}\DecValTok{1}\NormalTok{],}\DataTypeTok{to =}\NormalTok{ ratelims[}\DecValTok{2}\NormalTok{])}
\NormalTok{rate.grid}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0 1 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.ss <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(fit.ss, }\DataTypeTok{x =}\NormalTok{ rate.grid) }\CommentTok{# specify x; }
\CommentTok{# but we did not calculate CI in this function}
\NormalTok{pred.ss.df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{pred =}\NormalTok{ pred.ss}\OperatorTok{$}\NormalTok{y,}
                         \DataTypeTok{rate =}\NormalTok{ rate.grid)}
\NormalTok{pred.ss.df}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       pred rate
## 1 3.807699    0
## 2 2.501594    1
## 3 2.756369    2
## 4 3.361577    3
## 5 4.055344    4
## 6 4.518176    5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ train_data, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ user_rating_ver, }\DataTypeTok{y =}\NormalTok{ user_rating)) }\OperatorTok{+}
\StringTok{     }\KeywordTok{geom_point}\NormalTok{(}\DataTypeTok{color =} \KeywordTok{rgb}\NormalTok{(.}\DecValTok{2}\NormalTok{, .}\DecValTok{4}\NormalTok{, .}\DecValTok{2}\NormalTok{, .}\DecValTok{5}\NormalTok{))}\OperatorTok{+}
\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ rate, }\DataTypeTok{y =}\NormalTok{ pred), }\DataTypeTok{data =}\NormalTok{ pred.ss.df,}
          \DataTypeTok{color =} \KeywordTok{rgb}\NormalTok{(.}\DecValTok{8}\NormalTok{, .}\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\OperatorTok{+}\StringTok{ }\KeywordTok{theme_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-21-1}

\paragraph{local regression}\label{local-regression}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit.loess <-}\StringTok{ }\KeywordTok{loess}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\NormalTok{size_megabytes, }\DataTypeTok{data =}\NormalTok{ train_data)}
\KeywordTok{summary}\NormalTok{(fit.loess)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Call:
## loess(formula = user_rating ~ size_megabytes, data = train_data)
## 
## Number of Observations: 4702 
## Equivalent Number of Parameters: 5.67 
## Residual Standard Error: 0.7161 
## Trace of smoother matrix: 6.21  (exact)
## 
## Control settings:
##   span     :  0.75 
##   degree   :  2 
##   family   :  gaussian
##   surface  :  interpolate      cell = 0.2
##   normalize:  TRUE
##  parametric:  FALSE
## drop.square:  FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.loess <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(fit.loess, }\DataTypeTok{newdata =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{size_megabytes =}\NormalTok{ size.grid))}

\NormalTok{pred.loess.df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{pred =}\NormalTok{ pred.loess,}
                            \DataTypeTok{size =}\NormalTok{ size.grid)}

\NormalTok{p }\OperatorTok{+}\StringTok{ }\KeywordTok{geom_line}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ size, }\DataTypeTok{y =}\NormalTok{ pred), }\DataTypeTok{data =}\NormalTok{ pred.loess.df,}
              \DataTypeTok{color =} \KeywordTok{rgb}\NormalTok{(.}\DecValTok{8}\NormalTok{, .}\DecValTok{1}\NormalTok{, .}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\OperatorTok{+}\StringTok{ }\KeywordTok{theme_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-22-1}

\paragraph{GAM}\label{gam}

mgcv package

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Start with linear model; do not assume nonlinear trait}
\NormalTok{gam.m1 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\NormalTok{size_megabytes }\OperatorTok{+}\StringTok{ }\NormalTok{price }\OperatorTok{+}\StringTok{ }
\StringTok{                }\NormalTok{user_rating_ver }\OperatorTok{+}\StringTok{ }\NormalTok{cont_rating }\OperatorTok{+}\StringTok{ }\NormalTok{prime_genre }\OperatorTok{+}\StringTok{ }\NormalTok{sup_devices_num }\OperatorTok{+}
\StringTok{                }\NormalTok{ipad_sc_urls_num }\OperatorTok{+}\StringTok{ }\NormalTok{lang_num , }\DataTypeTok{data =}\NormalTok{ train_data) }
\KeywordTok{summary}\NormalTok{(gam.m1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## user_rating ~ size_megabytes + price + user_rating_ver + cont_rating + 
##     prime_genre + sup_devices_num + ipad_sc_urls_num + lang_num
## 
## Parametric coefficients:
##                    Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       2.963e+00  9.958e-02  29.759  < 2e-16 ***
## size_megabytes   -5.369e-05  2.998e-05  -1.791  0.07338 .  
## price             4.426e-03  1.845e-03   2.399  0.01650 *  
## user_rating_ver   2.367e-01  6.893e-03  34.335  < 2e-16 ***
## cont_rating17+    3.643e-02  4.157e-02   0.876  0.38081    
## cont_rating4+    -5.827e-02  2.610e-02  -2.232  0.02564 *  
## cont_rating9+    -7.236e-03  3.407e-02  -0.212  0.83183    
## prime_genre       1.352e-01  2.217e-02   6.099 1.16e-09 ***
## sup_devices_num   1.577e-03  2.455e-03   0.643  0.52056    
## ipad_sc_urls_num  2.144e-02  5.310e-03   4.037 5.50e-05 ***
## lang_num          4.043e-03  1.115e-03   3.627  0.00029 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## 
## R-sq.(adj) =  0.255   Deviance explained = 25.7%
## GCV = 0.3956  Scale est. = 0.39468   n = 4702
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# add one non-linear component to size bytes}
\NormalTok{gam.m2 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{s}\NormalTok{(size_megabytes) }\OperatorTok{+}\StringTok{ }\NormalTok{price }\OperatorTok{+}
\StringTok{                }\NormalTok{user_rating_ver }\OperatorTok{+}\StringTok{ }\NormalTok{cont_rating }\OperatorTok{+}\StringTok{ }\NormalTok{prime_genre }\OperatorTok{+}\StringTok{ }\NormalTok{sup_devices_num }\OperatorTok{+}
\StringTok{                }\NormalTok{ipad_sc_urls_num }\OperatorTok{+}\StringTok{ }\NormalTok{lang_num, }\DataTypeTok{data =}\NormalTok{ train_data)}
\KeywordTok{summary}\NormalTok{(gam.m2) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Family: gaussian 
## Link function: identity 
## 
## Formula:
## user_rating ~ s(size_megabytes) + price + user_rating_ver + cont_rating + 
##     prime_genre + sup_devices_num + ipad_sc_urls_num + lang_num
## 
## Parametric coefficients:
##                   Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       2.978159   0.098589  30.208  < 2e-16 ***
## price             0.005050   0.001846   2.736  0.00625 ** 
## user_rating_ver   0.236489   0.006869  34.430  < 2e-16 ***
## cont_rating17+    0.027024   0.041502   0.651  0.51499    
## cont_rating4+    -0.057664   0.026054  -2.213  0.02693 *  
## cont_rating9+    -0.006744   0.034191  -0.197  0.84364    
## prime_genre       0.117905   0.022467   5.248 1.61e-07 ***
## sup_devices_num   0.001682   0.002449   0.687  0.49211    
## ipad_sc_urls_num  0.017396   0.005380   3.234  0.00123 ** 
## lang_num          0.003257   0.001120   2.907  0.00366 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##                     edf Ref.df     F  p-value    
## s(size_megabytes) 7.708  8.544 4.853 2.94e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.261   Deviance explained = 26.3%
## GCV = 0.39312  Scale est. = 0.39164   n = 4702
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#  add one non-linear component to lang_num}
\NormalTok{gam.m3 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{s}\NormalTok{(size_megabytes) }\OperatorTok{+}\StringTok{ }\NormalTok{price }\OperatorTok{+}\StringTok{ }
\StringTok{                }\NormalTok{user_rating_ver }\OperatorTok{+}\StringTok{ }\NormalTok{cont_rating }\OperatorTok{+}\StringTok{ }\NormalTok{prime_genre }\OperatorTok{+}\StringTok{ }\NormalTok{sup_devices_num }\OperatorTok{+}
\StringTok{                }\NormalTok{ipad_sc_urls_num }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(lang_num), }\DataTypeTok{data =}\NormalTok{ train_data)}

\CommentTok{# add one non-linear component to user rating of current version}
\NormalTok{gam.m4 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(user_rating }\OperatorTok{~}\StringTok{ }\KeywordTok{s}\NormalTok{(size_megabytes) }\OperatorTok{+}\StringTok{ }\NormalTok{price }\OperatorTok{+}\StringTok{ }
\StringTok{                }\KeywordTok{s}\NormalTok{(user_rating_ver) }\OperatorTok{+}\StringTok{ }\NormalTok{cont_rating }\OperatorTok{+}\StringTok{ }\NormalTok{prime_genre }\OperatorTok{+}\StringTok{ }\NormalTok{sup_devices_num }\OperatorTok{+}
\StringTok{                }\NormalTok{ipad_sc_urls_num }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(lang_num), }\DataTypeTok{data =}\NormalTok{ train_data)}

\KeywordTok{anova}\NormalTok{(gam.m1, gam.m2, gam.m3, gam.m4, }\DataTypeTok{test =} \StringTok{"F"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Deviance Table
## 
## Model 1: user_rating ~ size_megabytes + price + user_rating_ver + cont_rating + 
##     prime_genre + sup_devices_num + ipad_sc_urls_num + lang_num
## Model 2: user_rating ~ s(size_megabytes) + price + user_rating_ver + cont_rating + 
##     prime_genre + sup_devices_num + ipad_sc_urls_num + lang_num
## Model 3: user_rating ~ s(size_megabytes) + price + user_rating_ver + cont_rating + 
##     prime_genre + sup_devices_num + ipad_sc_urls_num + s(lang_num)
## Model 4: user_rating ~ s(size_megabytes) + price + s(user_rating_ver) + 
##     cont_rating + prime_genre + sup_devices_num + ipad_sc_urls_num + 
##     s(lang_num)
##   Resid. Df Resid. Dev     Df Deviance        F    Pr(>F)    
## 1    4691.0     1851.4                                       
## 2    4683.5     1834.5 7.5443    16.88   8.2687 1.128e-10 ***
## 3    4679.3     1825.1 4.1217     9.44   8.4601 6.081e-07 ***
## 4    4674.9     1265.9 4.4536   559.17 463.8916 < 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

plot smoothing component

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(gam.m4)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-24-1}

use caret package to do gam

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{gam.fit <-}\StringTok{ }\KeywordTok{train}\NormalTok{(x_train, y_train,}
                 \DataTypeTok{method =} \StringTok{"gam"}\NormalTok{, }\CommentTok{# use gam}
                 \DataTypeTok{tuneGrid =} \KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{method =} \StringTok{"GCV.Cp"}\NormalTok{, }\DataTypeTok{select =} \KeywordTok{c}\NormalTok{(}\OtherTok{TRUE}\NormalTok{,}\OtherTok{FALSE}\NormalTok{)),}
                 \CommentTok{# two tuning parameters (but not real tuning paramteres from what we taught in class)}
                 \CommentTok{# select = c(to do feature selection or not(set coeffcients to be zero or not), method is gcv from mgcv package)}
                 \DataTypeTok{trControl =}\NormalTok{ ctrl1)}

\NormalTok{gam.fit}\OperatorTok{$}\NormalTok{bestTune }\CommentTok{# by doing feature selection, get a better error in terms of MSE}

\NormalTok{gam.fit}\OperatorTok{$}\NormalTok{finalModel }
\end{Highlighting}
\end{Shaded}

\paragraph{MARS}\label{mars}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(pdp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'pdp'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:purrr':
## 
##     partial
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(earth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: plotmo
\end{verbatim}

\begin{verbatim}
## Loading required package: plotrix
\end{verbatim}

\begin{verbatim}
## Loading required package: TeachingDemos
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mars_grid <-}\StringTok{ }\KeywordTok{expand.grid}\NormalTok{(}\DataTypeTok{degree =} \DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{,  }\CommentTok{# to include interaction or not}
                         \DataTypeTok{nprune =} \DecValTok{2}\OperatorTok{:}\DecValTok{11}\NormalTok{) }\CommentTok{# how many variables you want to include}
\NormalTok{mars_grid}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    degree nprune
## 1       1      2
## 2       2      2
## 3       1      3
## 4       2      3
## 5       1      4
## 6       2      4
## 7       1      5
## 8       2      5
## 9       1      6
## 10      2      6
## 11      1      7
## 12      2      7
## 13      1      8
## 14      2      8
## 15      1      9
## 16      2      9
## 17      1     10
## 18      2     10
## 19      1     11
## 20      2     11
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\NormalTok{mars.fit <-}\StringTok{ }\KeywordTok{train}\NormalTok{(x_train, y_train,}
                 \DataTypeTok{method =} \StringTok{"earth"}\NormalTok{,}
                 \DataTypeTok{tuneGrid =}\NormalTok{ mars_grid,}
                 \DataTypeTok{trControl =}\NormalTok{ ctrl1)}

\KeywordTok{ggplot}\NormalTok{(mars.fit) }\CommentTok{# each line is for one degree;}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-26-1}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mars.fit}\OperatorTok{$}\NormalTok{bestTune }\CommentTok{# model contains 3 variables with interaction terms}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    nprune degree
## 10     11      1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{coef}\NormalTok{(mars.fit}\OperatorTok{$}\NormalTok{finalModel)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            (Intercept)   h(user_rating_ver-1)   h(1-user_rating_ver) 
##            2.993630649            0.280965560            1.354065765 
##            prime_genre h(user_rating_ver-4.5)   h(user_rating_ver-2) 
##            0.118120452           -0.303267163            0.348398190 
##         h(30-lang_num)  h(size_megabytes-118)  h(118-size_megabytes) 
##           -0.003328511            0.005062028           -0.004994209 
##   h(size_megabytes-44)          h(5.99-price) 
##           -0.005147150           -0.015408822
\end{verbatim}

\paragraph{Compare models}\label{compare-models}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#jpeg("rmse.jpg")}
\KeywordTok{bwplot}\NormalTok{(}\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\CommentTok{#gam = gam.fit,}
                      \DataTypeTok{lm =}\NormalTok{ lm.fit,}
                      \DataTypeTok{mars =}\NormalTok{ mars.fit,}
                      \DataTypeTok{ridge =}\NormalTok{ ridge.fit,}
                      \DataTypeTok{lasso =}\NormalTok{ lasso.fit,}
                      \DataTypeTok{enet =}\NormalTok{ enet.fit,}
                      \DataTypeTok{pcr =}\NormalTok{ pcr.fit,}
                      \DataTypeTok{pls =}\NormalTok{ pls.fit)), }\DataTypeTok{metric =} \StringTok{"RMSE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.9]{awesome_mag_files/figure-latex/unnamed-chunk-27-1}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#dev.off()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(}\KeywordTok{resamples}\NormalTok{(}\KeywordTok{list}\NormalTok{(}\CommentTok{#gam = gam.fit,}
                      \DataTypeTok{lm =}\NormalTok{ lm.fit,}
                      \DataTypeTok{mars =}\NormalTok{ mars.fit,}
                      \DataTypeTok{ridge =}\NormalTok{ ridge.fit,}
                      \DataTypeTok{lasso =}\NormalTok{ lasso.fit,}
                      \DataTypeTok{enet =}\NormalTok{ enet.fit,}
                      \DataTypeTok{pcr =}\NormalTok{ pcr.fit,}
                      \DataTypeTok{pls =}\NormalTok{ pls.fit)), }\DataTypeTok{metric =} \StringTok{"RMSE"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## summary.resamples(object = resamples(list(lm = lm.fit, mars =
##  mars.fit, ridge = ridge.fit, lasso = lasso.fit, enet = enet.fit, pcr
##  = pcr.fit, pls = pls.fit)), metric = "RMSE")
## 
## Models: lm, mars, ridge, lasso, enet, pcr, pls 
## Number of resamples: 50 
## 
## RMSE 
##            Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA's
## lm    0.5863014 0.6117991 0.6232496 0.6289451 0.6451086 0.7026959    0
## mars  0.4742350 0.5048572 0.5227044 0.5228728 0.5415354 0.5744478    0
## ridge 0.5871200 0.6096714 0.6235217 0.6289694 0.6453525 0.7012491    0
## lasso 0.5851028 0.6158286 0.6295917 0.6290490 0.6413175 0.6850979    0
## enet  0.5867800 0.6113575 0.6237916 0.6287702 0.6451504 0.7017853    0
## pcr   0.5864340 0.6108432 0.6232179 0.6283084 0.6441235 0.7024380    0
## pls   0.5864686 0.6117803 0.6234221 0.6288189 0.6442827 0.7027942    0
\end{verbatim}

\paragraph{Test MSE}\label{test-mse}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.elast <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(enet.fit}\OperatorTok{$}\NormalTok{finalModel, }\DataTypeTok{newx =}\NormalTok{ x_test, }\DataTypeTok{s =}\NormalTok{ enet.fit}\OperatorTok{$}\NormalTok{bestTune}\OperatorTok{$}\NormalTok{lambda, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\KeywordTok{mean}\NormalTok{((pred.elast }\OperatorTok{-}\StringTok{ }\NormalTok{y_test)}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{# 0.407}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4069269
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.mars <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(mars.fit}\OperatorTok{$}\NormalTok{finalModel, }\DataTypeTok{newdata =}\NormalTok{ x_test, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\KeywordTok{mean}\NormalTok{((pred.mars }\OperatorTok{-}\StringTok{ }\NormalTok{y_test)}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{# 0.283}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2830337
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.lasso <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(lasso.fit}\OperatorTok{$}\NormalTok{finalModel, }\DataTypeTok{newx =}\NormalTok{ x_test, }\DataTypeTok{s =}\NormalTok{ lasso.fit}\OperatorTok{$}\NormalTok{bestTune}\OperatorTok{$}\NormalTok{lambda, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\KeywordTok{mean}\NormalTok{((pred.lasso }\OperatorTok{-}\StringTok{ }\NormalTok{y_test)}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{# 0.407}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.407003
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.pcr <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(pcr.fit}\OperatorTok{$}\NormalTok{finalModel, }\DataTypeTok{newdata =}\NormalTok{ x_test, }\DataTypeTok{ncomp =}\NormalTok{ pcr.fit}\OperatorTok{$}\NormalTok{bestTune[[}\DecValTok{1}\NormalTok{]], }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\KeywordTok{mean}\NormalTok{((pred.pcr }\OperatorTok{-}\StringTok{ }\NormalTok{y_test)}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{# 0.407}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4068258
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.pls <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(pls.fit}\OperatorTok{$}\NormalTok{finalModel, }\DataTypeTok{newdata =}\NormalTok{ x_test, }\DataTypeTok{ncomp =}\NormalTok{ pls.fit}\OperatorTok{$}\NormalTok{bestTune}\OperatorTok{$}\NormalTok{ncomp, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\KeywordTok{mean}\NormalTok{((pred.pls }\OperatorTok{-}\StringTok{ }\NormalTok{y_test)}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{# 0.406}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4065176
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.lm <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(lm.fit, }\DataTypeTok{newdata =}\NormalTok{ test_data)}
\KeywordTok{mean}\NormalTok{((pred.lm }\OperatorTok{-}\StringTok{ }\NormalTok{y_test)}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{# 0.41}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.406799
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred.ridge <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(ridge.fit}\OperatorTok{$}\NormalTok{finalModel, }\DataTypeTok{newx =}\NormalTok{ x_test, }\DataTypeTok{s =}\NormalTok{ ridge.fit}\OperatorTok{$}\NormalTok{bestTune}\OperatorTok{$}\NormalTok{lambda, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\KeywordTok{mean}\NormalTok{((pred.ridge }\OperatorTok{-}\StringTok{ }\NormalTok{y_test)}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{# 0.406}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4061881
\end{verbatim}


\end{document}
