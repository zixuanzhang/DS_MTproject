---
title: "EDA"
author: "Eleanor Zhang"
date: "3/23/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(caret)
library(boot)
library(corrplot)
```

## Read data 

Read data
```{r}
apple <- read_csv("./data/AppleStore.csv") %>% 
  janitor::clean_names() 

str(apple) # 7197 observations 17 variables (including response)
unique(apple$currency) # all price on USD unit, so remove this

apple <- apple %>% 
  select(-c(x1, track_name, id, currency, ver)) # %>% 

  
 # mutate(cont_rating = factor(cont_rating, levels = c("4+", "9+", "12+", "17+")),
         #prime_genre = as.factor(prime_genre))
  
summary(apple)
anyNA(apple) # no missing values
str(apple) # select 11 covariables 
```


Response: user_rating  

Predictors might be used:  
user_rating: Average User Rating value (for all version)
Predictors: 

1.	size_bytes: Size (in Bytes)
2.	price: Price amount ($)
3.	rating_count_tot: User Rating counts (for all version)
4.	rating_count_ver: User Rating counts (for current version)
5.	user_rating_ver: Average User Rating value (for current version)
6.	ver: Latest version code (removed)
7.	cont_rating: Content Rating
8.	prime_genre: Primary Genre
9.	sup_devices.num: Number of supporting devices
10.	ipadSc_urls.num: Number of screenshots shown for display
11.	lang.num: Number of supported languages
12.	vpp_lic: Vpp Device Based Licensing Enabled

## EDA

```{r}
# predictor pool
x <- model.matrix(user_rating ~., data = apple)[,-1] # remove the intercept column; design matrix
x
dim(x)
# response
y <- apple$user_rating
unique(y)
```

feature plot
```{r}
theme1 <- trellis.par.get()
theme1$plot.symbol$col <- rgb(.2, .4, .2, .5)
theme1$plot.symbol$pch <- 16
theme1$plot.line$col <- rgb(.8, .1, .1, 1)
theme1$plot.line$lwd <- 2
theme1$strip.background$col <- rgb(.0, .2, .6, .2)
trellis.par.set(theme1)
featurePlot(x, y, plot = "scatter", labels = c("","Y"),
            type = c("p"), layout = c(5,2)) # ???? 
```

correlation plot excluding two factor variables : content rating and genre
```{r}
apple <- apple %>% select(user_rating, everything())
pairs(apple[-c(7,8)])

appleCor <-  cor(apple[-c(7,8)]) # correlation matrix of the modified dataset above
summary(appleCor[upper.tri(appleCor)]) # summary
findCorrelation(appleCor, cutoff = .75)

appleCor > 0.75 # user rating (all version) and user rating (current version)

corrplot(cor(x), method = "circle",tl.cex = 0.5)

table(apple$prime_genre) # games are oversampled
table(apple$cont_rating) # 4+ is oversampled
```

Comment: correlation between covariates are not significant; user rating and user rating version are highly correlated. (0.77)
Games, 4+ rating are oversampled

check linear dependency of numerical predictors (no problematic predictors)
```{r}
nzv <- nearZeroVar(apple) # nzv: near zero variance
dim(apple[, -nzv])
```




